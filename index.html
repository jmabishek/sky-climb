<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‚òÅ Infinite Sky Climb</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: radial-gradient(circle at top, #020617, #020617);
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #e5e7eb;
    }
    .wrapper {
      width: 100%;
      max-width: 900px;
      padding: 12px;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      gap: 8px;
      flex-wrap: wrap;
    }
    .title {
      font-size: 1.3rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .stats {
      display: flex;
      gap: 10px;
      font-size: 0.9rem;
      flex-wrap: wrap;
    }
    .controls {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }
    button {
      border: none;
      border-radius: 999px;
      padding: 5px 12px;
      font-size: 0.8rem;
      cursor: pointer;
      background: #020617;
      color: #e5e7eb;
      border: 1px solid #1f2937;
      transition: background 0.15s ease, transform 0.1s ease, box-shadow 0.15s ease;
    }
    button:hover { background: #0b1120; box-shadow: 0 4px 12px rgba(15,23,42,0.6); }
    button:active { transform: translateY(1px); box-shadow: none; }

    .canvas-shell {
      background: #020617;
      border-radius: 18px;
      overflow: hidden;
      border: 1px solid #1f2937;
      box-shadow: 0 18px 40px rgba(15,23,42,0.9);
      position: relative;
    }
    canvas {
      display: block;
      width: 100%;
      height: auto;
      touch-action: none;
    }

    .overlay {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, rgba(15,23,42,0.97), rgba(15,23,42,0.98));
      color: #e5e7eb;
      flex-direction: column;
      gap: 10px;
      text-align: center;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s ease;
    }
    .overlay.visible { opacity: 1; pointer-events: auto; }
    .overlay h1 { font-size: 1.7rem; margin-bottom: 4px; }
    .overlay p { font-size: 0.9rem; opacity: 0.85; max-width: 320px; }
    .overlay .btn-row { display: flex; gap: 8px; margin-top: 8px; flex-wrap: wrap; justify-content: center; }

    .skin-row { display: flex; gap: 8px; justify-content: center; margin-top: 4px; }
    .skin-btn {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      border: 2px solid transparent;
      padding: 0;
    }
    .skin-btn.selected { border-color: #facc15; }
    #skinPreview {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      margin: 4px auto;
      box-shadow: 0 0 16px rgba(250, 204, 21, 0.6);
    }

    .mobile-buttons {
      display: flex;
      justify-content: center;
      gap: 14px;
      margin-top: 8px;
    }
    .mobile-btn {
      width: 72px;
      height: 40px;
      border-radius: 999px;
      font-size: 1.1rem;
    }
    .footer {
      margin-top: 6px;
      font-size: 0.7rem;
      text-align: right;
      opacity: 0.7;
    }

    @media (max-width: 600px) {
      .title { font-size: 1.1rem; }
      .stats { font-size: 0.8rem; }
      button { font-size: 0.75rem; padding: 4px 10px; }
      .mobile-btn { width: 64px; height: 38px; }
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="top-bar">
      <div class="title">‚òÅ Infinite Sky Climb</div>
      <div class="stats">
        <div>Height: <span id="score">0</span> m</div>
        <div>Best: <span id="bestScore">0</span> m</div>
        <div>Lives: <span id="lives">3</span></div>
      </div>
      <div class="controls">
        <button id="musicBtn">üîà Music</button>
        <button id="pauseBtn">‚è∏ Pause</button>
        <button id="resumeBtn">‚ñ∂ Resume</button>
      </div>
    </div>

    <div class="canvas-shell">
      <canvas id="gameCanvas"></canvas>

      <!-- START MENU OVERLAY -->
      <div id="menuOverlay" class="overlay visible">
        <h1>‚òÅ Infinite Sky Climb</h1>
        <p>Select your ball skin, then press Start to climb through clouds, space, and the galaxy.</p>
        <div>
          <div style="margin-bottom:4px; font-size:0.85rem; opacity:0.85;">Selected Skin</div>
          <div id="skinPreview"></div>
          <div class="skin-row">
            <button class="skin-btn" data-color="#4ade80" title="Mint"></button>
            <button class="skin-btn" data-color="#f97316" title="Sunset"></button>
            <button class="skin-btn" data-color="#38bdf8" title="Sky"></button>
          </div>
        </div>
        <div class="btn-row">
          <button id="startBtn">‚ñ∂ Start Game</button>
        </div>
      </div>

      <!-- GAME OVER OVERLAY -->
      <div id="gameOverOverlay" class="overlay">
        <h1>Game Over</h1>
        <p id="gameOverText">You reached 0 m. Try again!</p>
        <div class="btn-row">
          <button id="restartBtn">üîÅ Restart</button>
          <button id="menuBtn">üè† Main Menu</button>
        </div>
      </div>
    </div>

    <div class="mobile-buttons">
      <button id="leftBtn" class="mobile-btn">‚üµ</button>
      <button id="rightBtn" class="mobile-btn">‚ü∂</button>
    </div>
    <div class="footer" id="dailyChallenge"></div>
  </div>

  <audio id="bgm" loop src="https://cdn.pixabay.com/audio/2022/03/15/audio_3f52b3c172.mp3"></audio>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    function resizeCanvas() {
      const width = document.querySelector(".canvas-shell").clientWidth;
      const height = Math.max(260, Math.min(520, width * 0.65));
      canvas.width = width;
      canvas.height = height;
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    // Daily challenge text
    const dailyChallengeEl = document.getElementById("dailyChallenge");
    (function setDailyChallenge() {
      const today = new Date();
      const seed = today.getFullYear() * 10000 + (today.getMonth() + 1) * 100 + today.getDate();
      const target = 500 + (seed % 1000);
      dailyChallengeEl.textContent = `üéØ Daily Challenge: Reach ${target} m today!`;
    })();

    // UI elements
    const scoreEl = document.getElementById("score");
    const bestScoreEl = document.getElementById("bestScore");
    const livesEl = document.getElementById("lives");
    const musicBtn = document.getElementById("musicBtn");
    const pauseBtn = document.getElementById("pauseBtn");
    const resumeBtn = document.getElementById("resumeBtn");
    const bgm = document.getElementById("bgm");

    const menuOverlay = document.getElementById("menuOverlay");
    const gameOverOverlay = document.getElementById("gameOverOverlay");
    const gameOverText = document.getElementById("gameOverText");
    const startBtn = document.getElementById("startBtn");
    const restartBtn = document.getElementById("restartBtn");
    const menuBtn = document.getElementById("menuBtn");

    const skinPreview = document.getElementById("skinPreview");
    const skinButtons = Array.from(document.querySelectorAll(".skin-btn"));

    const leftBtn = document.getElementById("leftBtn");
    const rightBtn = document.getElementById("rightBtn");

    // Game state
    const STATE = { MENU: "menu", PLAY: "play", OVER: "over" };
    let gameState = STATE.MENU;
    let paused = false;

    // Player & world
    let player;
    let platforms = [];
    let particles = [];
    let cloudsLayers = [[], [], []]; // parallax layers

    let score = 0;
    let bestScore = parseInt(localStorage.getItem("skyClimbBest") || "0", 10);
    bestScoreEl.textContent = bestScore;
    let lives = 3;

    let gravity = 0.25;

    // Skins
    const SKINS = ["#4ade80", "#f97316", "#38bdf8"];
    let selectedSkin = localStorage.getItem("skyClimbSkin") || SKINS[0];

    function updateSkinUI() {
      skinPreview.style.background = selectedSkin;
      skinButtons.forEach((btn) => {
        const c = btn.getAttribute("data-color");
        btn.style.background = c;
        btn.classList.toggle("selected", c === selectedSkin);
      });
    }

    skinButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        selectedSkin = btn.getAttribute("data-color");
        localStorage.setItem("skyClimbSkin", selectedSkin);
        updateSkinUI();
      });
    });
    updateSkinUI();

    // Parallax clouds
    function createCloud(layer) {
      const width = 60 + Math.random() * 80;
      const height = 18 + Math.random() * 14;
      return {
        layer,
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        w: width,
        h: height,
        speedX: (0.2 + Math.random() * 0.4) * (layer + 1) * (Math.random() < 0.5 ? 1 : -1),
        alpha: 0.15 + 0.1 * layer,
      };
    }

    function initClouds() {
      cloudsLayers = [[], [], []];
      for (let layer = 0; layer < 3; layer++) {
        const count = 6 + layer * 4;
        for (let i = 0; i < count; i++) {
          cloudsLayers[layer].push(createCloud(layer));
        }
      }
    }

    function updateClouds() {
      cloudsLayers.forEach((layerArr) => {
        layerArr.forEach((c) => {
          c.x += c.speedX;
          if (c.x < -c.w) c.x = canvas.width + c.w;
          if (c.x > canvas.width + c.w) c.x = -c.w;
        });
      });
    }

    function drawClouds() {
      cloudsLayers.forEach((layerArr, idx) => {
        layerArr.forEach((c) => {
          ctx.save();
          ctx.globalAlpha = c.alpha;
          ctx.fillStyle = idx === 0 ? "#f9fafb" : idx === 1 ? "#e5e7eb" : "#cbd5f5";
          ctx.beginPath();
          ctx.ellipse(c.x, c.y, c.w, c.h, 0, 0, Math.PI * 2);
          ctx.fill();
          ctx.restore();
        });
      });
    }

    // Platforms
    function createPlatform(y) {
      return {
        x: Math.random() * (canvas.width - 100),
        y,
        w: 100,
        h: 14,
        breakable: Math.random() < 0.3,
        hits: 0,
      };
    }

    function initPlatforms() {
      platforms = [];
      const gap = 110;
      for (let i = 0; i < 12; i++) {
        platforms.push(createPlatform(canvas.height - i * gap));
      }
    }

    // Player
    function createPlayer() {
      return {
        x: canvas.width / 2,
        y: canvas.height - 80,
        r: 18,
        dx: 0,
        dy: -6,
        color: selectedSkin,
        trail: [],
        shield: false,
      };
    }

    // Particles
    function spawnParticles(x, y, color, count = 12) {
      for (let i = 0; i < count; i++) {
        particles.push({
          x,
          y,
          dx: (Math.random() - 0.5) * 3,
          dy: (Math.random() - 0.5) * 3,
          life: 30 + Math.random() * 20,
          color,
        });
      }
    }

    function updateParticles() {
      particles = particles.filter((p) => {
        p.x += p.dx;
        p.y += p.dy;
        p.dy += 0.04;
        p.life--;
        return p.life > 0;
      });
    }

    function drawParticles() {
      particles.forEach((p) => {
        ctx.save();
        ctx.globalAlpha = Math.max(p.life / 40, 0);
        ctx.fillStyle = p.color;
        ctx.fillRect(p.x, p.y, 3, 3);
        ctx.restore();
      });
    }

    // Input
    let left = false;
    let right = false;

    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowLeft") left = true;
      if (e.key === "ArrowRight") right = true;
    });
    document.addEventListener("keyup", (e) => {
      if (e.key === "ArrowLeft") left = false;
      if (e.key === "ArrowRight") right = false;
    });

    function bindTouch(btn, dir) {
      btn.addEventListener("touchstart", (e) => {
        e.preventDefault();
        if (dir === "left") left = true;
        if (dir === "right") right = true;
      });
      btn.addEventListener("touchend", (e) => {
        e.preventDefault();
        if (dir === "left") left = false;
        if (dir === "right") right = false;
      });
    }
    bindTouch(leftBtn, "left");
    bindTouch(rightBtn, "right");

    // Music
    let musicOn = false;
    function tryPlayMusic() {
      if (!musicOn) {
        bgm.volume = 0.35;
        bgm.play().catch(() => {});
        musicOn = true;
        musicBtn.textContent = "üîä Music";
      }
    }
    musicBtn.addEventListener("click", () => {
      if (!musicOn) {
        tryPlayMusic();
      } else {
        bgm.pause();
        musicOn = false;
        musicBtn.textContent = "üîà Music";
      }
    });

    pauseBtn.addEventListener("click", () => {
      if (gameState === STATE.PLAY) paused = true;
    });
    resumeBtn.addEventListener("click", () => {
      if (gameState === STATE.PLAY) paused = false;
    });

    // State transitions
    function goToMenu() {
      gameState = STATE.MENU;
      paused = false;
      menuOverlay.classList.add("visible");
      gameOverOverlay.classList.remove("visible");
    }

    function startGame() {
      // Reset world
      score = 0;
      lives = 3;
      scoreEl.textContent = score;
      livesEl.textContent = lives;

      initClouds();
      initPlatforms();
      player = createPlayer();
      particles = [];

      gameState = STATE.PLAY;
      paused = false;
      menuOverlay.classList.remove("visible");
      gameOverOverlay.classList.remove("visible");
      tryPlayMusic();
    }

    function gameOver() {
      gameState = STATE.OVER;
      paused = true;
      gameOverText.textContent = `You reached ${score} m. Try again!`;
      gameOverOverlay.classList.add("visible");

      if (score > bestScore) {
        bestScore = score;
        bestScoreEl.textContent = bestScore;
        localStorage.setItem("skyClimbBest", bestScore.toString());
        gameOverText.textContent = `New High Score: ${score} m üéâ`;
      }
    }

    startBtn.addEventListener("click", startGame);
    restartBtn.addEventListener("click", startGame);
    menuBtn.addEventListener("click", goToMenu);

    // World gradient by height
    function getWorldColors() {
      if (score < 600) return ["#38bdf8", "#1d4ed8"]; // sky
      if (score < 1400) return ["#0f172a", "#4b21a2"]; // space
      return ["#020617", "#9333ea"]; // galaxy
    }

    // Main update
    function update() {
      if (gameState !== STATE.PLAY || paused) return;

      // Movement
      if (left) player.dx = -4;
      else if (right) player.dx = 4;
      else player.dx = 0;

      player.x += player.dx;
      if (player.x < -player.r) player.x = canvas.width + player.r;
      if (player.x > canvas.width + player.r) player.x = -player.r;

      // Gravity
      player.dy += gravity;
      player.y += player.dy;

      // Trail
      player.trail.push({ x: player.x, y: player.y, life: 18 });
      if (player.trail.length > 40) player.trail.shift();

      // Platform collision (only when falling)
      if (player.dy > 0) {
        platforms.forEach((p) => {
          if (
            player.y + player.r >= p.y &&
            player.y + player.r <= p.y + p.h + 4 &&
            player.x >= p.x &&
            player.x <= p.x + p.w
          ) {
            player.dy = -7.5;
            spawnParticles(player.x, p.y, "#e0f2fe", 14);
            if (p.breakable) {
              p.hits++;
              if (p.hits >= 2) {
                p.y = canvas.height + 999; // will recycle
              }
            }
          }
        });
      }

      // Infinite upward scroll
      if (player.y < canvas.height * 0.4) {
        const shift = canvas.height * 0.4 - player.y;
        player.y += shift;
        score += Math.floor(shift * 0.1);
        scoreEl.textContent = score;

        platforms.forEach((p) => {
          p.y += shift;
          if (p.y > canvas.height + 40) {
            p.y -= canvas.height + 160;
            p.x = Math.random() * (canvas.width - p.w);
            p.breakable = Math.random() < 0.3;
            p.hits = 0;
          }
        });

        cloudsLayers.forEach((layerArr) => {
          layerArr.forEach((c) => {
            c.y += shift * 0.2; // slower parallax scroll
            if (c.y > canvas.height + c.h) {
              c.y -= canvas.height + 2 * c.h;
            }
          });
        });
      }

      // Fell below screen
      if (player.y - player.r > canvas.height + 40) {
        lives--;
        livesEl.textContent = lives;
        spawnParticles(player.x, player.y, "#fecaca", 18);
        if (lives <= 0) {
          gameOver();
        } else {
          // respawn a bit above middle
          player.x = canvas.width / 2;
          player.y = canvas.height * 0.3;
          player.dy = -6;
        }
      }

      updateParticles();
      updateClouds();
    }

    // Main draw
    function draw() {
      // Background
      const [c1, c2] = getWorldColors();
      const grad = ctx.createLinearGradient(0, 0, 0, canvas.height);
      grad.addColorStop(0, c1);
      grad.addColorStop(1, c2);
      ctx.fillStyle = grad;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Clouds
      drawClouds();

      // Platforms
      platforms.forEach((p) => {
        const alpha = p.breakable ? 0.6 : 1;
        ctx.fillStyle = `rgba(56,189,248,${alpha})`;
        ctx.fillRect(p.x, p.y, p.w, p.h);
      });

      // Particles
      drawParticles();

      // Trail
      player?.trail.forEach((t) => {
        ctx.save();
        ctx.globalAlpha = t.life / 18;
        ctx.fillStyle = player.color;
        ctx.beginPath();
        ctx.arc(t.x, t.y, 4, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
        t.life--;
      });

      // Player
      if (player) {
        ctx.beginPath();
        ctx.arc(player.x, player.y, player.r, 0, Math.PI * 2);
        ctx.fillStyle = player.color;
        ctx.shadowColor = player.color;
        ctx.shadowBlur = 16;
        ctx.fill();
        ctx.shadowBlur = 0;
      }
    }

    function loop() {
      update();
      draw();
      requestAnimationFrame(loop);
    }

    // Init
    initClouds();
    initPlatforms();
    player = createPlayer();
    loop();
  </script>
</body>
</html>
//Update game with start menu + skins
